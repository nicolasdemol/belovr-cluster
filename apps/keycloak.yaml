apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: keycloak
  namespace: argocd
spec:
  project: belovr

  source:
    repoURL: oci://registry-1.docker.io/bitnamicharts/keycloak
    targetRevision: "25.2.0"
    path: .
    helm:
      valuesObject:
        global:
          security:
            allowInsecureImages: true

        image:
          registry: docker.io
          repository: keycloak/keycloak
          digest: "sha256:653852bfdea2be6e958b9e90a976eff1c6de34edd55f2f679bdc48ef16bc528e"

        auth:
          adminUser: admin
          adminPassword: "adminpass"

        postgresql:
          enabled: true
          image:
            registry: docker.io
            repository: bitnamisecure/postgresql
            digest: "sha256:14aa30df4c41d43590a0ae59b1963522f5e4344bedda67e1f2e423ea8267c115"
          auth:
            username: keycloak
            password: keycloakpass
            database: keycloak

  destination:
    server: https://kubernetes.default.svc
    namespace: belovr
